<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />
    <title>DCIT Job Board-Alumni</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: rgb(225, 227, 231);
        max-height: 100%;
        overflow: hidden;
      }
      
      header {
        background-color: rgb(57, 97, 185);
        color: #fff;
        padding: 10px;
        display: flex;
        align-items: center;
      }

      aside {
        background-color: white;
        border-radius: 10px;
        padding-right: 5px;
        overflow-y: scroll;
        height: 65%;
        padding-top: 0;
      }

      .btn-group button {
        background-color:  rgb(225, 227, 231);
        border: 1px;
        color: black;
        padding: 1.5%;
        cursor: pointer;
        float: right;
        border-radius: 4px;
      }

      .view-button {
        background-color: #062690;
        border: none;
        border-radius: 5px;
        color: white;
        padding: 5px 15px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin-left: 7vh;
        cursor: pointer;
      }

      .btn-group button.active {
        background-color: black;
        border: 1px solid rgb(185, 185, 185);
        color: rgb(255, 255, 255);
      }

      /* Clear floats (clearfix hack) */
      .btn-group:after {
        content: "";
        clear: both;
        display: table;
      }

      .btn-group button:not(:last-child) {
        border-left: none; /* Prevent double borders */
      }

      /* Add a background color on hover */
      .btn-group button:hover {
        background-color: rgb(27, 27, 179);
        color: white;
      }

      div.sticky {
        position: sticky;
        z-index: 10; /* Make sure it's on top of other content */
        top: 0;
        background-color: rgb(203, 203, 213);
        padding: 3%;
        font-size: 70%;
      }

      #uwi-logo{
        height: 10vh;
        width:10vh;
        border-radius: 35px;
        margin-right: 5px;
      }

      #company_logo{
        height:20vh;
        width:20vh;
        float:right;
        margin-bottom: 10px;
      }

      .logout {
        position: relative;
        margin-left: auto;
        background-color: rgb(57, 97, 185);
        color: #fff;
        padding: 10px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        text-decoration: none;
      }

      .subscribe {
        position: absolute;
        right: 210px;
        padding: 10px;
        background-color: rgb(57, 97, 185);
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
      }

      .unsubscribe {
        position: absolute;
        top: 30px;
        right: 90px;
        padding: 10px;
        background-color: rgb(57, 97, 185);
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
      }

      .logout:hover,
      .subscribe:hover,
      .unsubscribe:hover {
        background-color: rgb(98, 127, 191);
      }

      .subscription h2 {
        color: #333;
        margin-bottom: 10px;
      }

      .subscription p {
        color: #666;
        margin-bottom: 20px;
      }

      .subscription form {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .subscription input[type="email"],
      .subscription select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
      }

      #subscribe-btn {
        background-color: #007bff;
        color: white;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
      }

      #subscribe-btn:hover {
        background-color: #0056b3;
      }

      .email-input,
      .category-input,
      .subscribe-btn {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .fa-envelope,
      .fa-list,
      .fa-bell {
        color: #007bff;
      }

      .listings-container {
        max-width: 100%;
        height: 50%;
        padding: 2%;
        background-color: #d4d4d8;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        border-radius: 5px;
        overflow-y: scroll;
        z-index: 1;
      }

      .body-container {
        z-index: 1;
        max-width: 100%;
        padding: 2%;
        background-color: none;
        gap: 20px;
        overflow: none;
      }

      .container {
        z-index: 1;
        max-width: 100%;
        padding: 2%;
        background-color: none;
        display: grid;
        grid-template-columns: 3fr 1fr;
        gap: 0.5%;
        overflow: auto;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        font-weight: bold;
        display: block;
        margin-bottom: 5px;
      }

      .form-group input[type="text"],
      .form-group input[type="email"],
      .form-group input[type="tel"],
      .form-group input[type="file"] {
        width: 50%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
      }

      .form-group input[type="file"] {
        cursor: pointer;
      }

      .form-group input[type="submit"] {
        background-color: #333;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .form-group input[type="submit"]:hover {
        background-color: #555;
      }

      .popup-container {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 9999;
      }

      .subpopup-content {
        background-color: #fff;
        width: 450px;
        padding: 20px;
        border-radius: 10px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .close {
        position: absolute;
        top: 10px;
        right: 10px;
        cursor: pointer;
      }

      .popup {
        display: none;
        position: fixed;
        top: 0;
        margin-left: 10px;
        width: 50%;
        height: 50%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 9999;
        justify-content: center;
        align-items: center;
      }
      .popup-content {
        background-color: #fff;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        text-align: center;
        overflow: auto;
        position: relative;
      }
      .popup-form {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 9999;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 100%;
      }
      .close-btn {
        color: black;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        top: 10px;
        right: 10px;
        position: absolute;
      }
      .hidden {
        display: none;
      }

      .job_card {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 20px;
        margin-bottom: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        background-color: #ffffff;
      }
      
      .job_card:hover {
        box-shadow: 0 0 10px rgba(34, 4, 228, 0.1);
      }


      .job-header {
        font-weight: bold;
        cursor: pointer;
        margin-bottom: 5px;
      }

      .expand-btn {
        background: none;
        border: none;
        font-size: 1.5em;
        cursor: pointer;
      }

      .job-details {
        margin-top: 10px;
        margin-bottom: 0;
      }

      .job-details h5 {
      margin: 0;        
      padding: 0;       
      line-height: 1.5; 
      font-weight:normal;
      }

      .alert {
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 3px;
        font-size: 14px;
        opacity: 0.9;
        transition: opacity 0.3s ease;
        z-index: 2;
      }

      .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        z-index: 2;
      }

      .alert-unsuccessful {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
        z-index: 2;
      }

      #flash-messages {
      position: absolute;
      width: 100%;
      display: block; 
      z-index: 100; /*ensures flash message is displayed over content */
      }

      /* #working on mobile view */
      @media (max-width: 768px) {
        body {
          overflow-y: auto;
          height: auto;
        }

        .container {
          grid-template-columns: 1fr;
          height: auto;
        }

        .listings-container {
          grid-template-columns: 1fr;
          height: auto;
          padding: 1% 0;
        }

        .aside {
          width: 100%;
          margin-top: 0;
          height: auto;
        }

        .body-container {
          overflow-y: auto;
          padding: 2%;
        }

        .btn-group {
          display: flex;
          flex-direction: column;
          align-items: stretch;
        }

        .btn-group button {
          margin-right: 0;
          margin-bottom: 10px;
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <img id="uwi-logo" src="{{ url_for('static', filename='images/uwi_logo.jpg') }}" alt="uwi_logo">
      <h1>DCIT Job Board</h1>
      <button class="subscribe" id="displayPopup">Subscribe</button>
      <!-- <button class="unsubscribe">
            Unsubscribe
        </button> -->
      <!-- <a href="/unsubscribe" method="['POST']" class="unsubscribe">Unsubscribe</a> -->
      <form id="unsubscribeForm" action="/unsubscribe" method="POST">
        <!-- Add any additional hidden input fields if needed -->
        <button type="submit" class="unsubscribe">Unsubscribe</button>
      </form>

      <!-- <button class="logout">Logout</button> -->
      <a href="/logout" class="logout">Logout</a>
    </header>
    <div id="flash-messages">
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %} {% endif %} {% endwith %}
    </div>

    <div class="container">
      <div
        id="subpopup"
        class="popup-container"
        data-show-modal="{{ show_modal }}"
      >
        <div class="subpopup-content">
          <h2>Wecome Alumni</h2>

          <p>
            Welcome to the DCIT Job Board! Explore our curated job listings
            directly below. Whether you're a recent graduate or seasoned
            professional, find your perfect opportunity here. Stay updated by
            subscribing to our mailing list for the latest job postings. Start
            your journey to career success today!
          </p>

          <section class="subscription">
            <div class="box">
              <h2>Subscribe to Job Alerts</h2>
              <p>Get notified about new job opportunities.</p>
              <form id="subscription-form" action="/subscribe" method="POST">
                <!-- <div class="email-input">
                                <i class="fas fa-envelope"></i>
                                <input type="email" name="email" id="email" placeholder="Enter your email here" required>
                            </div> -->
                <div class="category-input">
                  <i class="fas fa-list"></i>
                  <select name="category" id="category" required>
                    <option value="">Select Company</option>
                    <option value="Software Engineer">Software Engineer</option>
                    <option value="Database Manager">Database Manager</option>
                    <option value="Cyber Security">Cyber Security</option>
                  </select>
                </div>
                <div class="subscribe-btn">
                  <i class="fas fa-bell"></i>
                  <button id="subscribe-btn" type="submit">Subscribe</button>
                </div>
              </form>
            </div>
          </section>
          <span class="close" id="subclose-btn">&times;</span>
        </div>
      </div>

      <!-- <div class="search">
            <input type="search" id="serachInput" placeholder="Search any job here">
            <select class="categories" id="category">
                <option>--select and option--</option>
                <option>Web Design</option>
                <option>Web Development</option>
                <option>Database Manager</option>
            </select>
        </div> -->
      <div class="body-container">
        <div class="btn-group">
          <h1>
            Latest Listings
            <button id="browse-companies">Browse Companies</button>
            <button id="browse-jobs" class="active">Brwose Jobs</button>
            <button id="browse-submitted-applications">Submitted Applications</button>
            <button id="saved-jobs">Saved Jobs</button>
          </h1>
        </div>
        <div class="listings-container" id="jobs-container">
          {% for job in jobs %}
          <div class="job_card">
            <div class="job-header">
                <h3>{{ job.title }}</h3>
      
            </div>
            <div class="job-details">
                <img id="company_logo" src="{{ url_for('static', filename='images/c_logo.jpg') }}" alt="c_logo">
                <h5><i class="fa-solid fa-building"></i>{{ " Company Name"}}</h5>
                <h5><i class="fa-solid fa-clock"></i> {{ job.position_type}}</h5>
                <h5><i class="fa-solid fa-location-crosshairs"></i> {{ job.job_site_address}}</h5>
                <h5>THIS IS A TEST</h5>
                <button>Save Listing</button>
                <button id="view-joblisting" class="view-button">View</button>
            </div>
          </div>
          {% endfor%}
        </div>
        <div class="listings-container" id="companies-container" style="display: none">
          {% for company in companies %}
          <div class="job_card">
            <div class="job-header">
                <h3>{{ company.registered_name }}</h3>
                <h5>{{ company.website_url }}</h5>
                <input
                  type="button"
                  class="view-button"
                  value="View Company Listings"
                />
            </div>
          </div>
          {% endfor%}
        </div>

       <div class="listings-container" id="applications-container" style="display: none">
        <!-- {% for company in companies %} to be changed when this fucntinonality updates CTZ--> 
        <div class="job_card">
          <div class="job-header">
              <h3>{{ "Application info" }}</h3>
              <h5>{{ "Application status" }}</h5>
              <input
                type="button"
                class="view-button"
                value="View Application"
              />
          </div>
        </div>
        <!-- {% endfor%} -->
        </div>
      </div>

      <!-- saved listings content -->
      <aside>
        <div class="sticky">
          <h1>Saved Listings</h1>
        </div>
        {% for job in jobs %}
        <div class="job_card">
          <div class="job-header">
              <h3>{{ job.title }}</h3>
              <h5>{{ "Company Name"}}</h5>
              <button>Remove</button>
              <input type="button" class="view-button" value="View" />
          </div>
        </div>

        {% endfor%}
      </aside>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const jobCards = document.querySelectorAll(".job_card");
        const searchInput = document.getElementById("searchInput");
        const expandBtns = document.querySelectorAll(".expand-btn");
        const applyBtns = document.querySelectorAll(".applyBtn"); // Select all apply buttons
        const closeFormBtns = document.querySelectorAll(".close-btn"); // Select all close buttons

        expandBtns.forEach((expandBtn) => {
          expandBtn.addEventListener("click", function () {
            const jobDetails = expandBtn.parentElement.nextElementSibling;
            toggleJobDetails(jobDetails, expandBtn);
          });
        });

        applyBtns.forEach((applyBtn) => {
          applyBtn.addEventListener("click", function (event) {
            event.preventDefault(); // Prevent the default link behavior
            const popupId = applyBtn.getAttribute("data-popup-id"); // Get the popup ID from data-popup-id attribute
            toggleFormPopup(popupId); // Toggle form popup visibility
          });
        });

        closeFormBtns.forEach((closeFormBtn) => {
          closeFormBtn.addEventListener("click", function (event) {
            event.preventDefault();
            const popupId = closeFormBtn.parentElement.parentElement.id; // Get the popup ID from parent element's ID
            toggleFormPopup(popupId); // Toggle form popup visibility
          });
        });

        // Function to toggle job details visibility
        function toggleJobDetails(jobDetails, expandBtn) {
          if (
            jobDetails.style.display === "none" ||
            jobDetails.style.display === ""
          ) {
            jobDetails.style.display = "block";
            expandBtn.textContent = "▲"; // Change arrow direction
          } else {
            jobDetails.style.display = "none";
            expandBtn.textContent = "▼"; // Change arrow direction
          }
        }

        // Function to toggle form popup visibility
        function toggleFormPopup(popupId) {
          const popup = document.getElementById(popupId);
          if (popup.classList.contains("hidden")) {
            popup.classList.remove("hidden");
            popup.style.display = "flex";
          } else {
            popup.classList.add("hidden");
            popup.style.display = "none";
          }
        }
      });

      document.addEventListener("DOMContentLoaded", function () {
        const jobCards = document.querySelectorAll(".job_card");
        const searchInput = document.getElementById("searchInput");

        searchInput.addEventListener("input", function () {
          const searchTerm = searchInput.value.trim().toLowerCase();
          filterJobs(searchTerm);
        });

        function filterJobs(searchTerm) {
          jobCards.forEach(function (jobCard) {
            const jobTitle = jobCard
              .querySelector(".job_details h2")
              .textContent.toLowerCase();
            if (jobTitle.includes(searchTerm)) {
              jobCard.style.display = "block";
            } else {
              jobCard.style.display = "none";
            }
          });
        }
      });

      document.addEventListener("DOMContentLoaded", function () {
        const popupContainer = document.getElementById("subpopup");
        const closeButton = document.getElementById("subclose-btn");
        const subscribeButton = document.getElementById("subscribe-btn");
        const displayPopupButton = document.getElementById("displayPopup");

        const showModal = popupContainer.dataset.showModal;

        // Function to show the popup
        function showPopup() {
          popupContainer.style.display = "block";
        }

        // Function to hide the popup
        function hidePopup() {
          popupContainer.style.display = "none";
        }

        if (showModal === "True") showPopup();

        // closeButton.addEventListener("click", hidePopup);

        displayPopupButton.addEventListener("click", showPopup);

        window.addEventListener("click", function (event) {
          if (event.target === popupContainer) {
            hidePopup();
          }
        });

        subscribeButton.addEventListener("click", function (event) {
          event.preventDefault(); // Prevent form submission
          //const emailInput = document.getElementById("email").value;
          const categoryInput = document.getElementById("category").value;

          const form = document.getElementById("subscription-form");
          form.submit();

          //console.log("Subscribing email:", emailInput, "Category:", categoryInput);
          hidePopup();
        });

        closeButton.addEventListener("click", function () {
          fetch("/update_modal_seen", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${localStorage.getItem("jwt_token")}`,
            },
          })
            .then((response) => response.json())
            .then((data) => {
              console.log(data.message);
              hidePopup();
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        });
      });

      // Hide flash messages after 3 seconds
      setTimeout(() => {
        const flashMessages = document.getElementById("flash-messages");
        if (flashMessages) {
          flashMessages.style.display = "none";
        }
      }, 3000); // 3000 milliseconds = 3 seconds

      // Get all the buttons and containers
      const browseCompaniesBtn = document.getElementById("browse-companies");
      const browseJobsBtn = document.getElementById("browse-jobs");
      const submittedApplicationsBtn = document.getElementById("browse-submitted-applications");

      const jobsContainer = document.getElementById("jobs-container");
      const companiesContainer = document.getElementById("companies-container");
      const applicationsContainer = document.getElementById("applications-container");

       // Function to show the content of the clicked category
      function showContent(containerToShow) {
        // Hide all containers
        jobsContainer.style.display = 'none';
        companiesContainer.style.display = 'none';
        applicationsContainer.style.display = 'none';

        // Show the selected container
        containerToShow.style.display = 'grid';
      }

      // Event listeners for the buttons
      browseCompaniesBtn.addEventListener('click', () => {
        showContent(companiesContainer);
        // Toggle active class
        browseCompaniesBtn.classList.add('active');
        browseJobsBtn.classList.remove('active');
        submittedApplicationsBtn.classList.remove('active');
      });

      browseJobsBtn.addEventListener('click', () => {
        showContent(jobsContainer);
        // Toggle active class
        browseCompaniesBtn.classList.remove('active');
        browseJobsBtn.classList.add('active');
        submittedApplicationsBtn.classList.remove('active');
      });

      submittedApplicationsBtn.addEventListener('click', () => {
        showContent(applicationsContainer);
        // Toggle active class
        browseCompaniesBtn.classList.remove('active');
        browseJobsBtn.classList.remove('active');
        submittedApplicationsBtn.classList.add('active');
      });

      // Initial load (show jobs by default)
      showContent(jobsContainer);

    </script>
  </body>
</html>
